services:
  django:
    build:
      context: .
      cache_from:
        - python:3.10-slim
    ports:
      - "8000:8000"
    env_file:
      - .env
    volumes:
      - ./core:/app/core
      - ./users:/app/users
      - ./vibe_scraper:/app/vibe_scraper
      - ./templates:/app/templates
      - ./static:/app/static
    restart: unless-stopped
    networks:
      - supabase_default
    external_links:
      - supabase_kong_vibe-code-ig-scraper-saas:supabase
      - supabase_db_vibe-code-ig-scraper-saas:db

  n8n:
    image: n8nio/n8n:latest
    ports:
      - "5678:5678"
    env_file:
      - .env
    volumes:
      - n8n_data:/home/node/.n8n
    restart: unless-stopped
    networks:
      - supabase_default
    external_links:
      - supabase_kong_vibe-code-ig-scraper-saas:supabase
      - supabase_db_vibe-code-ig-scraper-saas:db

networks:
  default:
    driver: bridge
  supabase_default:
    external: true

volumes:
  n8n_data: